# Быстрый старт: Работа с данными

## Что реализовано

Теперь блоки в WebFlow Studio могут автоматически заполняться данными из API!

## Как использовать (за 3 шага)

### Шаг 1: Создайте Data Source

1. Откройте проект в Studio
2. Нажмите кнопку **"Данные"** (левая панель, иконка Database)
3. Нажмите **"+ Новый источник"**
4. Заполните форму:
   - **Название**: "Hero API"
   - **Тип**: MOCK (для тестирования)
   - **Описание**: "Тестовые данные для Hero блока"

### Шаг 2: Добавьте Sample (пример ответа API)

1. В созданном источнике нажмите **"+ Добавить пример"**
2. Вставьте JSON:

```json
{
  "badge": "Новая фича",
  "title": "Данные из API работают!",
  "description": "Этот текст загружен из JSON ответа автоматически",
  "primaryButton": "Подключить API",
  "secondaryButton": "Документация"
}
```

3. **Label**: "Пример 1"
4. Сохраните

### Шаг 3: Подключите блок к данным

1. Выберите Hero блок на canvas
2. В инспекторе (правая панель) найдите секцию **"Источник данных"**
3. Выберите ваш Data Source: "Hero API"
4. Выберите Sample: "Пример 1"

**Готово!** Блок автоматически заполнится данными из JSON.

---

## Расширенная настройка: Маппинг полей

### Автоматический маппинг

По умолчанию система использует стандартные маппинги:
- `badge` → badge блока
- `title` → title блока
- и т.д.

### Ручная настройка

Если ваш JSON имеет другую структуру, настройте маппинг вручную:

1. После выбора Sample в инспекторе нажмите **"Настроить"** в секции "Маппинг полей"
2. Для каждого поля блока выберите откуда брать данные из JSON:

**Пример**: У вас JSON:
```json
{
  "header": "Мой заголовок",
  "subtitle": "Описание страницы",
  "cta": {
    "main": "Начать",
    "secondary": "Узнать больше"
  }
}
```

**Настройте маппинг**:
- `title` → `header`
- `description` → `subtitle`
- `primaryLabel` → `cta.main`
- `secondaryLabel` → `cta.secondary`

Система автоматически извлечёт данные по указанным путям!

---

## Примеры для разных блоков

### Stats блок

```json
{
  "metrics": [
    {
      "label": "Пользователи",
      "value": "2.5K",
      "detail": "Активных сегодня"
    },
    {
      "label": "Проекты",
      "value": "142",
      "detail": "В разработке"
    }
  ]
}
```

### Workflow блок

```json
{
  "stages": [
    {
      "id": "step1",
      "label": "Планирование",
      "title": "Спроектируйте архитектуру",
      "description": "Определите требования и зависимости",
      "tags": ["Design", "Planning"]
    },
    {
      "id": "step2",
      "label": "Разработка",
      "title": "Соберите прототип",
      "description": "Используйте готовые блоки Studio",
      "tags": ["Development", "Prototype"]
    }
  ]
}
```

---

## Вложенные данные

Система поддерживает извлечение из вложенных объектов:

```json
{
  "response": {
    "data": {
      "hero": {
        "badge": "v2.0",
        "title": "Глубоко вложенный заголовок"
      }
    }
  }
}
```

**Field Path**: `response.data.hero.title` → извлечёт "Глубоко вложенный заголовок"

---

## Массивы

Для доступа к элементам массива используйте индексы:

```json
{
  "products": [
    { "name": "Premium", "price": "$49" },
    { "name": "Enterprise", "price": "$199" }
  ]
}
```

**Field Path**: `products[0].name` → извлечёт "Premium"

---

## UI Инспектора

После выбора Sample в инспекторе отображается:

1. **Превью JSON** - просмотр данных
2. **Маппинг полей** - секция с кнопкой "Настроить"
   - По умолчанию: автоматический маппинг
   - Расширенный режим: выпадающие списки для каждого поля
3. **Доступные поля** - список всех путей в JSON
4. **Превью данных** - полный JSON для справки

---

## Техническая информация

**Файлы**:
- [src/lib/data-binding.ts](src/lib/data-binding.ts) - утилиты маппинга
- [src/lib/sample-data.ts](src/lib/sample-data.ts) - готовые примеры
- [src/app/dashboard/projects/field-mapping-editor.tsx](src/app/dashboard/projects/field-mapping-editor.tsx) - UI компонент
- [src/app/dashboard/projects/studio-preview/renderer.tsx](src/app/dashboard/projects/studio-preview/renderer.tsx) - рендеринг с данными

**Функции**:
- `applyDataToBlockProps()` - применяет JSON к props блока
- `getValueByPath()` - извлекает значение по пути
- `extractAvailableFields()` - находит все доступные поля в JSON

---

## Следующие шаги

- [ ] REST/GraphQL запросы в реальном времени
- [ ] Валидация схемы данных
- [ ] Кеширование ответов
- [ ] Трансформации данных (filters, formatters)
- [ ] Условный рендеринг блоков
